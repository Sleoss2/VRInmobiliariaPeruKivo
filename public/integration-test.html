<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VR Scene - Module Integration Test</title>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      background: #1a1a1a; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #fff;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #2e86de;
      margin-bottom: 30px;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 30px;
    }

    .status-card {
      background: #222;
      border: 2px solid #2e86de;
      border-radius: 4px;
      padding: 15px;
    }

    .status-card h3 {
      margin: 0 0 10px 0;
      color: #2e86de;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .status-value {
      font-family: 'Courier New', monospace;
      font-size: 12px;
      color: #aaffaa;
      margin: 5px 0;
    }

    .status-value.warning {
      color: #ffaa00;
    }

    .status-value.error {
      color: #ff6b6b;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      background: #2e86de;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: 0.2s;
    }

    button:hover {
      background: #1456a0;
      box-shadow: 0 0 8px rgba(46, 134, 222, 0.5);
    }

    button:disabled {
      background: #666;
      cursor: not-allowed;
      opacity: 0.6;
    }

    .console {
      background: #000;
      border: 1px solid #00ff00;
      border-radius: 4px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #00ff00;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .console-line {
      margin: 2px 0;
      padding: 2px;
    }

    .console-line.info { color: #00ff00; }
    .console-line.warn { color: #ffaa00; }
    .console-line.error { color: #ff6b6b; }
    .console-line.success { color: #00ff00; text-shadow: 0 0 5px #00ff00; }

    .module-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .module-item {
      background: #222;
      border: 1px solid #444;
      border-radius: 4px;
      padding: 12px;
    }

    .module-item h4 {
      margin: 0 0 8px 0;
      color: #2e86de;
      font-size: 12px;
    }

    .module-item ul {
      margin: 0;
      padding-left: 20px;
      font-size: 11px;
      color: #aaa;
    }

    .module-item ul li {
      margin: 4px 0;
    }

    .success {
      color: #00ff00;
    }

    .error {
      color: #ff6b6b;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° VRInmobiliariaPeruKivo - Integration Test</h1>

    <div class="status-grid">
      <div class="status-card">
        <h3>üìä System Status</h3>
        <div class="status-value">Status: <span id="system-status">LOADING...</span></div>
        <div class="status-value">Modules: <span id="module-count">0</span>/7</div>
        <div class="status-value">Errors: <span id="error-count">0</span></div>
      </div>

      <div class="status-card">
        <h3>‚ö° Performance</h3>
        <div class="status-value">FPS: <span id="fps-value">--</span></div>
        <div class="status-value">Frame Time: <span id="frame-time">--</span>ms</div>
        <div class="status-value">Memory: <span id="memory-value">--</span>MB</div>
      </div>

      <div class="status-card">
        <h3>üìä Analytics</h3>
        <div class="status-value">Session: <span id="session-id">--</span></div>
        <div class="status-value">Interactions: <span id="interaction-count">0</span></div>
        <div class="status-value">Duration: <span id="session-duration">0s</span></div>
      </div>

      <div class="status-card">
        <h3>üéØ Gestures</h3>
        <div class="status-value">Pinches: <span id="pinch-count">0</span></div>
        <div class="status-value">Palms: <span id="palm-count">0</span></div>
        <div class="status-value">Points: <span id="point-count">0</span></div>
      </div>
    </div>

    <div class="button-group">
      <button id="test-analytics">üìä Test Analytics</button>
      <button id="test-performance">‚ö° Test Performance</button>
      <button id="test-gestures">üéØ Test Gestures</button>
      <button id="export-data">üíæ Export Data</button>
      <button id="clear-console">üóëÔ∏è Clear Console</button>
      <button id="toggle-profiler">üìà Toggle Profiler</button>
    </div>

    <h2>üì¶ Integrated Modules</h2>
    <div class="module-list">
      <div class="module-item">
        <h4>‚úì vr-event-emitter.js</h4>
        <ul>
          <li>Pub/Sub system</li>
          <li>Event routing</li>
          <li>Cross-module comms</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì analytics.js</h4>
        <ul>
          <li>Session tracking</li>
          <li>Interaction logging</li>
          <li>Batch uploads</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì gesture-recognizer.js</h4>
        <ul>
          <li>Pinch detection</li>
          <li>Open palm detection</li>
          <li>Point gestures</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì performance-profiler.js</h4>
        <ul>
          <li>FPS monitoring</li>
          <li>Memory tracking</li>
          <li>Latency detection</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì hand-pose-tracker.js</h4>
        <ul>
          <li>Joint tracking</li>
          <li>Pose analysis</li>
          <li>Velocity calc</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì debug-dashboard.js</h4>
        <ul>
          <li>Real-time stats</li>
          <li>Tab interface</li>
          <li>Data export</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>‚úì config.js</h4>
        <ul>
          <li>50+ settings</li>
          <li>Hot-update</li>
          <li>Validation</li>
        </ul>
      </div>
    </div>

    <h2>üîß API Endpoints</h2>
    <div class="module-list">
      <div class="module-item">
        <h4>Session Management</h4>
        <ul>
          <li>POST /api/analytics/session</li>
          <li>Starts tracking</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>Data Collection</h4>
        <ul>
          <li>POST /api/analytics/interactions</li>
          <li>POST /api/analytics/gestures</li>
          <li>POST /api/analytics/performance</li>
        </ul>
      </div>

      <div class="module-item">
        <h4>Data Retrieval</h4>
        <ul>
          <li>GET /api/analytics/summary</li>
          <li>GET /api/analytics/data</li>
        </ul>
      </div>
    </div>

    <h2>üìù Console Output</h2>
    <div class="console" id="console">
      <div class="console-line success">‚úì Integration test page loaded</div>
      <div class="console-line info">Testing module availability...</div>
    </div>
  </div>

  <script>
    // Utility functions
    const log = {
      info: (msg) => console.log(`[INFO] ${msg}`),
      warn: (msg) => console.warn(`[WARN] ${msg}`),
      error: (msg) => console.error(`[ERROR] ${msg}`),
      success: (msg) => console.log(`[SUCCESS] ${msg}`)
    };

    const consoleEl = document.getElementById('console');
    const addConsole = (msg, type = 'info') => {
      const line = document.createElement('div');
      line.className = `console-line ${type}`;
      line.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
      consoleEl.appendChild(line);
      consoleEl.scrollTop = consoleEl.scrollHeight;
    };

    // Test module availability
    let moduleCount = 0;
    const testModules = () => {
      const modules = [
        'vr-event-emitter.js',
        'analytics.js',
        'gesture-recognizer.js',
        'performance-profiler.js',
        'hand-pose-tracker.js',
        'debug-dashboard.js',
        'config.js'
      ];

      addConsole(`Testing ${modules.length} modules...`, 'info');

      // In vr.html, these are imported via ES modules
      // This test page just verifies the API endpoints are working
      modules.forEach(mod => {
        addConsole(`‚úì ${mod} should be loaded in vr.html`, 'success');
        moduleCount++;
      });

      document.getElementById('module-count').textContent = moduleCount;
      document.getElementById('system-status').textContent = 'READY ‚úì';
    };

    // Test API endpoints
    const testAPIEndpoints = async () => {
      addConsole('Testing API endpoints...', 'info');

      try {
        // Test session endpoint
        const sessionRes = await fetch('/api/analytics/session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userAgent: navigator.userAgent,
            startTime: Date.now()
          })
        });

        if (sessionRes.ok) {
          const data = await sessionRes.json();
          addConsole(`‚úì Session endpoint working: ${data.sessionId}`, 'success');
          document.getElementById('session-id').textContent = data.sessionId.substring(0, 12) + '...';
        }

        // Test summary endpoint
        const summaryRes = await fetch('/api/analytics/summary');
        if (summaryRes.ok) {
          const summary = await summaryRes.json();
          addConsole(`‚úì Summary endpoint working`, 'success');
        }
      } catch (err) {
        addConsole(`‚úó API test failed: ${err.message}`, 'error');
      }
    };

    // Button handlers
    document.getElementById('test-analytics').addEventListener('click', async () => {
      addConsole('Simulating analytics events...', 'info');
      
      const events = [
        { type: 'grab', panelId: 'test', success: true },
        { type: 'drag', distance: 5.2 },
        { type: 'property_view', propertyId: 'prop-001' }
      ];

      for (const event of events) {
        await fetch('/api/analytics/interactions', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ events: [event] })
        });
        addConsole(`‚úì Logged ${event.type}`, 'success');
      }
    });

    document.getElementById('test-gestures').addEventListener('click', async () => {
      addConsole('Simulating gesture events...', 'info');
      
      const gestures = [
        { type: 'pinch', confidence: 0.95 },
        { type: 'open_palm', confidence: 0.87 },
        { type: 'point', confidence: 0.92 }
      ];

      for (const gesture of gestures) {
        await fetch('/api/analytics/gestures', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ events: [gesture] })
        });
        addConsole(`‚úì Gesture detected: ${gesture.type}`, 'success');
      }
    });

    document.getElementById('test-performance').addEventListener('click', async () => {
      addConsole('Simulating performance metrics...', 'info');
      
      const metrics = {
        fps: 87,
        frameTime: 11.5,
        memory: 125.4,
        latency: 24.2
      };

      await fetch('/api/analytics/performance', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ metrics })
      });
      
      addConsole(`‚úì FPS: ${metrics.fps}, Memory: ${metrics.memory}MB`, 'success');
    });

    document.getElementById('export-data').addEventListener('click', async () => {
      addConsole('Exporting analytics data...', 'info');
      
      try {
        const res = await fetch('/api/analytics/data');
        const data = await res.json();
        const json = JSON.stringify(data, null, 2);
        
        // Create download link
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `analytics-export-${Date.now()}.json`;
        link.click();
        URL.revokeObjectURL(url);
        
        addConsole(`‚úì Data exported (${Object.keys(data).length} categories)`, 'success');
      } catch (err) {
        addConsole(`‚úó Export failed: ${err.message}`, 'error');
      }
    };

    document.getElementById('clear-console').addEventListener('click', () => {
      consoleEl.innerHTML = '<div class="console-line success">‚úì Console cleared</div>';
    });

    document.getElementById('toggle-profiler').addEventListener('click', () => {
      addConsole('Profiler toggle would be called from VR scene', 'info');
    });

    // Update stats periodically
    setInterval(() => {
      const now = new Date();
      document.getElementById('session-duration').textContent = 
        Math.floor((now.getTime() - startTime) / 1000) + 's';
    }, 1000);

    // Initialize
    const startTime = Date.now();
    testModules();
    testAPIEndpoints();
    addConsole('‚úì Integration test ready', 'success');
  </script>
</body>
</html>
